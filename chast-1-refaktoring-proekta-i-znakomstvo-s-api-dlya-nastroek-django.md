# Часть 1: Рефакторинг проекта и знакомство с API для настроек Django

В этом разделе рассматриваются вопросы, касающиеся изменения структуры проекта, дается введение в API для настроек Django, а также проверяется работоспособность проекта!

---

## Введение

Для тех, кто только что присоединился к нам, предыдущая часть современного учебника по Django находится здесь: [Часть 0: Введение и начальная настройка](/chast-0-vvedenie-i-nachalnaya-nastroika.md).

GitHub этого проекта и всех его частей можно найти по [этой ссылке](https://github.com/djstein/modern-django).

На данный момент мы успешно создали Django проект. Тем не менее, предстоит ещё много сделать прежде, чем мы сможем сказать, что его можно использовать для локальной разработки и создания нашего первого приложения. Сначала мы должны изменить наш файл зависимостей проекта \(файл `requirements.txt` - прим. переводчика\). Затем мы должны изменить настройки проекта. Мы создадим набор переменных окружения для хранения секретных значений. Все это приведет к увеличению скорости разработки, тестирования и развертывания нашего приложения в будущем.

После изменения настроек, мы пройдемся по стандартной части API для настроек Django, которые используются нашим проектом и были созданы при первом создании `settings.py`. Также мы познакомимся с некоторыми часто используемыми настройками не создаваемыми по умолчанию, например, касающиеся обработки статических файлов. Понимание API для настроек Django - это первый шаг, позволяющий пролить свет на то, что называется _Магией Django_. Мы проведем ещё одну небольшую реструктуризацию и затем убедимся в работоспособности проекта!

Важно, чтобы все новые пользователи чувствовали себя уверенно при работе с настройками Django, поэтому я извиняюсь перед теми из Вас, кто хорошо знает Django или хочет начать работать с [REST API](https://en.wikipedia.org/wiki/Representational_state_transfer). Я могу только попробовать развеселить Вас во время изучения частей касающихся настроек, как эта \(на этот раз все смешные картинки находятся внизу\).

**Замечание:** Будем откровенны. В этой части Вы увидите структуру приложения, аналогичную структуре, которую создала [Django команда Cookiecutter](https://github.com/pydanny/cookiecutter-django) \(**C**ookie**c**utter **D**jango - CCD\). Если мы не будем использовать CCD проект, то в конечном итоге просто расширим базовый Django проект, пока нам не понадобятся какие-то более сложные части, поэтому мне кажется, что такой способ лучше. Команда CCD столкнулась с множеством локальных и продакшен проблем и решила их. Я принял во внимание их структуру, сравнивая её с той, что нужна нам. Хотя на ранних стадиях наш проект может казаться похожим на их, важно пояснить что делается на каждом этапе вместо того, чтобы слепо создавать шаблонный проект. Наш проект будет сильно отличаться в будущем , но сейчас Вы можете заметить структурное сходство. Например, существенная разница будет заключаться в том, что мы удалим формирование страниц на стороне сервера \(как это делается в CDD и многих других проектах\), а будем использовать REST API в сочетании с фронтэнд JavaScript фреймворком.

**Временное замечание:** Это замечание касается тех, кто использовал старую версию Части 0 \(до 24/02/2017\), поскольку мы обновили структуру проекта. В частности была обновлена команда `django-admin startproject` из части 0. Простите, ребята. Чтобы привести старую структуру приложения к новой потребуется большое количество изменений. Поэтому проще для всех будет, если те, кто использовал старую версию Части 0, просто удалят каталог `project` и создадут проект, используя новое имя и путь.

Для этого перейдите в каталог `modern-django`, удалите старый проект и создайте новый. Используйте команды:

```
# Команды
cd ~/git/modern-django/
rm -rf project/
django-admin startproject config .
```

> Примечание переводчика. Эта часть переводилась после 24/02/2017, следовательно, ничего исправлять не надо.

## Используемые технологии

В этой части мы изучим намного меньше технологий.

* Django настройки: "Файл с настройками Django содержит полную конфигурацию установленного Django проекта” \([источник](https://docs.djangoproject.com/en/1.10/topics/settings/)\). Это набор файлов/конфигураций, которые мы изучим в этой части! Это основа любого Django проекта.
* Переменные окружения: "Набор динамически задаваемых значений, которые могут повлиять на поведение запущенных процессов в компьютере. Они являются частью среды, в которой выполняется процесс" \([источник](https://en.wikipedia.org/wiki/Environment_variable)\). Мы создадим множество переменных окружения в процессе изучения.
* django-environ: "Позволяет Вам, используя 12 переменных окружения, настраивать Ваше Django приложение" \([источник](https://github.com/joke2k/django-environ)\). Мы установим этот пакет, чтобы упростить работу с переменными окружения для Django!

## Подробное пошаговое руководство

Продолжая с того места, на котором мы остановились в части 0, наша текущая структура проекта выглядит следующим образом!

```
modern-django
├── LICENSE
├── README.md
├── config
│   ├── __init__.py
│   ├── settings.py
│   ├── urls.py
│   └── wsgi.py
├── manage.py
└── requirements.txt
```

С этого момента, я буду предполагать, что Вы находитесь в каталоге `modern-django`, если не указано иное. Чтобы перейти в каталог `modern-django`, используйте следующую команду:

```
# Команда
cd ~/git/modern-django/
```

### 1. Изменяем requirements.txt

В этом разделе мы осуществим рефакторинг `requirements.txt`, сделав его намного более удобным в эксплуатации. Сначала создайте каталог с названием `requirements` в каталоге `modern-django`. Затем скопируйте текущий файл `requirements.txt` в него, переименовав в base.txt. После этого перейдите в каталог `requirements` и создайте файлы с зависимостями для локального, продакшен и тестового окружения.

```
# Команда
mkdir requirements/
mv requirements.txt requirements/base.txt
cd requirements/
touch local.txt production.txt test.txt
```

Теперь мы можем изменять список Python приложений, которые будет использовать наше виртуальное окружение \(или [Docker](https://en.wikipedia.org/wiki/Docker_%28software%29) образ\), основываясь на окружении \(локальная разработка, продакшен или  тестирование\).

#### 1-A. Добавляем django-environ в base.txt {#3c5a}

В файл base.txt, на основе которого будут создаваться все окружения, добавим [django-environ](https://github.com/joke2k/django-environ). Это позволит упростить настройку Django сразу по двум направлениям:

1. Упрощает использование переменных окружения
2. Упрощает пути к файлам

Откройте файл `requirments/base.txt` в Вашем любимом текстовом редакторе и добавьте следующую строку под `django==1.10.5`:

```
django-environ==0.4.1
```

#### **1-B. Осуществляем наследование локальных, продакшен и тестовых зависимостей от base.txt**

Теперь в наши файлы local.txt, production.txt и test.txt мы добавим строку, которая будет рекурсивно получать все зависимости из base.txt. Добавим эту строку в начало только что созданных файлов:

```
-r base.txt
```

Аналогично тому как мы добавили `django` в старый файл `requirements.txt` в части 0, мы будем продолжать добавлять сторонние приложения в проект, используя один из этих файлов. Новые строки будут добавлены в этот файл позднее, во время изучения пособия, а сейчас пора обратить внимание на `settings.py`.

### 2. Изменяем settings.py

В этом разделе, мы осуществим рефакторинг `settings.py`, сделав его более удобным в эксплуатации и разделим его аналогично тому как мы сделали это с `requirements.txt`.  Сначала создадим новый каталог `settings` внутри `config`:

```
# Команда
mkdir config/settings/
```

Теперь переместите файл `settings.py` в каталог `settings` и переименуйте в `base.py`:

```
# Команда
mv config/settings.py config/settings/base.py
```

Далее создайте файлы с настройками для каждого окружения \(локального, продакшен и тестового\):

```
# Команда
cd config/settings/
touch local.py production.py test.py
```

Опять в Вашем любимом текстовом редакторе в начале `local.py`, `production.py` и `test.py` импортируйте `base.py`, добавив:

```
from .base import *
```

Теперь, заложив основу, поря просмотреть и реорганизовать файл настроек `base.py`.

**Замечание:** В вышеприведенной строке импорт осуществлялся следующим образом: `import *`.  Хороший специалист импортирует только те части классов/модулей/библиотек, которые ему необходимы, но этот случай, является исключением.

### 3. Знакомство с API для настроек Django 

Пока в base.py находятся только стандартные настройки, созданные командой `django-admin startproject`. Ниже мы рассмотрим каждую настройку одну за другой - определим её своими словами и отредактируем в случае необходимости.

#### 3-A. Добавляем django-environ 



