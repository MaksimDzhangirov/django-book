# Часть 2: REST API, приложения и Django REST фреймворк

В этом \(достаточно большом\) разделе рассматриваются HTTP протокол, REST, Django приложения \(как понятие\), представления, URL-адреса и основы Django REST фреймворка.

---

## Введение

Предыдущие части пособия, касающиеся технической разработки, можно найти здесь:

* [Часть 0: Введение и начальная настройка](/chast-0-vvedenie-i-nachalnaya-nastroika.md)
* [Часть 1: Рефакторинг проекта и знакомство с API для настроек Django](/chast-1-refaktoring-proekta-i-znakomstvo-s-api-dlya-nastroek-django.md)

После того как Вы прочитали эти части и выполнили действия, указанные в них, у нас есть прочный фундамент для нашего приложения, готовый для дальнейших модификаций. Эта часть начинается с краткого курса по HTTP. Затем поясняется понятие "приложения" в Django. Наконец, большая часть этого раздела посвящена краткому введению в Django REST фреймворк.

После пояснения основных понятий, мы рассмотрим некоторые ключевые функции Django REST фреймворка. Они будут использоваться при создания API приложения для работы со встроенной моделью `User`. Одновременно с  этим мы научимся взаимодействовать с REST API в терминале.

## Используемые технологии

В этом разделе рассматриваются технологии, связанные с Django приложениями, основные HTTP и REST стандарты, Django REST фреймворк и программы, используемые при работе с API в терминале.

* [Django приложения](https://docs.djangoproject.com/en/1.11/ref/applications/): "Под термином "приложение" понимается Python пакет, предоставляющий некоторый набор функций. Приложения могут повторно использоваться в различных проектах" \([источник](https://docs.djangoproject.com/en/1.11/ref/applications/)\). Django проект состоит из множества Приложений, которые можно повторно использовать в других проектах. Более подробно Django приложения мы рассмотрим ниже.
* [HTTP](https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol). Сокращение от Hypertext Transfer Protocol \(протокол передачи гипертекста\). HTTP является протоколом передачи данных по схеме "[запрос-ответ](https://en.wikipedia.org/wiki/Request–response)" в [модели клиент-сервер](https://en.wikipedia.org/wiki/Client–server_model) \([источник](https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol)\).
* [HTTP методы/действия](https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Request_methods): Методы, как определено в HTTP стандартах, "указывают на желаемую операцию, которая должна быть выполнена над ресурсом" \([источник](https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Request_methods)\). Основными методами являются GET и POST. Существуют и другие, например, DELETE, PUT, PATCH и т. д. Конкретный URL-адрес может выполнять различные функции в зависимости от метода, переданного ему в HTTP-запросе.
* [RESTful](https://en.wikipedia.org/wiki/Representational_state_transfer). Сокращение от Representational State Transfer \(репрезентативная передача состояния\). "Веб-службы, совместимые с REST, позволяют запрашивающим системам получать доступ к текстовым представлениям [веб-ресурсов](https://en.wikipedia.org/wiki/Web_resource) и манипулировать ими, используя единый и предопределенный набор операций, не зависящих от предыдущего состояния ресурсов" \([источник](https://en.wikipedia.org/wiki/Representational_state_transfer)\). Это означает, что REST приложения имеют стандартный набор/структуру HTTP ресурсов, предоставляющих данные клиентам с сервера, в зависимости от используемого HTTP метода.
* Django REST фреймворк: "Django REST фреймворк - это мощный и гибкий инструментарий для создания Web API" \([источник](http://www.django-rest-framework.org/)\). Мы будем использовать приложение Django REST фреймворк, чтобы облегчить интегрирование REST API в существующий функционал Django!

## Подробное пошаговое руководство

### 1. Краткий курс по HTTP и REST

Глубоко не вникая в принципы построения сетей , я поясню HTTP \(протокол передачи гипертекста\).

### 1-A. Принцип работы Интернета, используя уровни модели OSI

В [концептуальную модель, используемую в Интернет](https://en.wikipedia.org/wiki/Internet_protocol_suite), \(Internet Protocol Suite\) входят четыре больших уровня. А именно:

1. Прикладной уровень
2. Транспортный уровень
3. Интернет уровень
4. Канальный уровень

HTTP \(протокол передачи гипертекста\) - это структура для хранения "данных". Он находится в самом верхнем уровне - прикладном уровне. Он перемещается по Интернету с помощью транспортного уровня. наиболее часто используемыми технологиями транспортного уровня являются [TCP](https://en.wikipedia.org/wiki/Transmission_Control_Protocol) и [UDP](https://en.wikipedia.org/wiki/User_Datagram_Protocol). TCP/UDP пакеты содержат в себе HTTP и перемещаются благодаря Интернету и канальному уровню. Чтобы лучше понять как работают сети и Интернет, изучите [7-уровневую модель OSI](https://en.wikipedia.org/wiki/OSI_model).

### 1-B. URLы и ресурсы

Доступ к HTTP обычно осуществляется с помощью HTTP URI. URI - это [Uniform Resource Identifier](https://en.wikipedia.org/wiki/Uniform_Resource_Identifier) \(унифицированный идентификатор ресурса\). URL - \([Uniform Resource Locator](https://en.wikipedia.org/wiki/Uniform_Resource_Locator) - единообразный локатор ресурса\) - это особый тип URI, который используется для идентификации веб-адреса. Поэтому, когда мы говорим о ссылке, например, [https://www.instagram.com/](https://www.instagram.com/), мы говорим о HTTP ресурсе. Таким образом, HTTP URI, принимает форму HTTP URL.

Мы используем URLы для определения HTTP ресурсов доступных нам. Их назначение должно быть понятно из названия! Например, [https://www.instagram.com/accounts/login/](https://www.instagram.com/accounts/login/) описывает ресурс, позволяющий пользователю войти в систему.

### 1-C. HTTP запросы и ответы

HTTP ресурсы предоставляются через **запросы** и **ответы**. HTTP **запрос** указывает - "дай мне это" или "сделай это " серверу. Сервер будет выполнять определенную последовательность процессов, основываясь на данных запроса, определяя какие функции должны быть вызваны и какие данные должны быть возвращены. Как только это процессы будут завершены, сервер посылает обратно HTTP **ответ**. В этом ответе сообщается - "я сделал это" или "вот &lt;ресурс&gt;, который был запрошен" кроме стандартных сообщений об успешном выполнении запроса или возникшей ошибки.

### 1.4 HTTP методы

Когда выполняется HTTP запрос, он содержит конкретный метод, определяющий действие, которое будет выполнено над ресурсом. Один и тот же ресурс, доступный по URL-адресу, может приминать HTTP запросы с различными типами методом и выполнять различные функции, в зависимости от указанного метода.

Наиболее важными HTTP методами являются `GET` и `POST`.

* `GET`: используется для получения данных. Например, для получения домашней страницы, изображений в Instagram
* `POST`: используется для отправки данных на сервер. Например, при входе в систему, загрузки изображений в Instagram

Назначение всех остальных методов довольно легко определить из названия. [Вы можете узнать о них больше здесь.](https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Request_methods)

Чтобы показать как HTTP ресурс может работать с различными типами HTTP запросов + различными комбинациями метода, мы будем использовать пример URL-адреса из Instagram:

`https://www.instagram.com/media/<media-id>/likes`

[Документацию к этому API можно найти здесь.](https://www.instagram.com/developer/endpoints/likes/)

Этот URL-адрес позволяет нам выполнять операции с лайками фото или видео пользователя. Выполняя HTTP запросы, используя разные методы, к этому URL-адресу можно осуществлять различные операции:

* Запрос с методом `GET`: возвратит список всех лайков для медиа-ресурса
* Запрос с методом `POST`: позволит текущему пользователю лайкнуть медиа-ресурс

### 1.5 Коды состояния

После обработки запроса сервер пытается отправить HTTP-ответ клиенту. Начало ответа будет содержать код состояния результата запроса.

В Википедии утверждается, что коды состояний делятся на пять основных различных классов \([источник](https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Status_codes)\). Эти классы и случаи, когда такой код состояния возвращается, приведены ниже:

1. Информационные \(1XX\): Вряд ли Вы часто будете встречаться с кодом состояния 1XX
2. Успешные \(2XX\): 200 OK \(возвращается при успешном получении страницы\)
3. Перенаправление \(3XX\): 304 Не изменился \(закэшированный CSS файл не изменился\)
4. Ошибка клиента \(4XX\): 404 Не найдено \(страница не найдена\)
5. Ошибка сервера \(5XX\): 500 Внутренняя ошибка сервера \(общая ошибка\)

При использовании команды `manage.py runserver` Вы увидите запросы, методы, ответы и коды статуса , отображающиеся в терминале! Два GET запроса/ответа показаны ниже. Один вернул внутреннюю ошибку сервера с кодом 500, а другой - 200 код при обращении к URL главной страницы.

![](/images/part2/1.png)

Пример двух GET запросов/ответов

### 1.6 **RESTful API**

HTTP-ресурс из Instragram, используемый ранее, - это часть их RESTful API!

`https://www.instagram.com/media/<media-id>/likes`

Как было сказано выше, REST - это сокращение от репрезентативной передачи состояния. RESTful API - это структурированный набор HTTP-ресурсов. Эти ресурсы описывают функции/модели базы данных и выполняют манипуляции над этими ресурсами с помощью набора стандартных HTTP-запросов.

Эти стандарты определяют как должны быть структурированы URL-адреса и какие функции должны выполняться , основываясь на заданных HTTP методах. RESTful API должно быть структурировано таким образом, чтобы все ресурсы представляли модель данных. Назначение методов, поддерживаемых ресурсом, должно быть очевидно из названия. Метод `GET` при обращении к ресурсу должен возвращать все значения модели, связанной с этим ресурсом, например, обращение к ресурсу `users/` должно возвращать всех пользователей в базе данных. Если указано значение первичного ключа \(т. е. конкретного отношения в базе данных\), то нужно возвращать только данные этого пользователя `users/1/`. В то же время, обращение к этому же ресурсу методом `POST` потребует передачи необходимых данных для создания пользователя. Использование метода `POST` для ресурса `users/1/` позволит обновить данные для пользователя с первичным ключом 1. \*\* Существует ряд других особенностей, которые мы рассмотрим при написании API!

Мы должны структурировать все наши URL-адреса так, чтобы они соответствовали моделям в нашей базе данных, чтобы сделать наше приложение максимально RESTful! Мы **НЕ** должны создавать ресурсы, которые при обращении к ним, предоставляют доступ к произвольным функциям.

\*\* При написании реальных приложений мы будем использовать методы `PUT` или `PATCH` для этих типов функций. Но сейчас мы рассматриваем базовые принципы написания RESTful API.

### 1.7 Резюме

На данный момент вышесказанного должно быть достаточно для написания базового API. Однако в будущем значение основных HTTP-концепций будет необходимо для написания нестандартных, пользовательских API и пользовательских обработчиков ответов от сервера на фронтэнде.

                                                                                                                        \*\*\*

## 2. Введение в Djangp приложения





